generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement()) @map("UserId")
  username String? @map("Username") @db.VarChar(50)
  email    String? @map("Email") @db.VarChar(255)
  password String? @map("Password") @db.VarChar(255)
  status   String? @default("A") @map("Status") @db.VarChar(5)

  roles    RolUsuario[]

  @@map("User")
}

model Rol {
  id        Int      @id @default(autoincrement()) @map("RolId")
  nombre    String   @map("RolNombre") @db.VarChar(50)
  descripcion String? @map("descripcion") @db.VarChar(255)
  usuarios  RolUsuario[]

  permisosModulos PermisosModulos[]

  @@map("Rol")
}

model RolUsuario {
  id_usuario Int  @map("UserId")
  id_rol     Int  @map("RolId")

  user User @relation(fields: [id_usuario], references: [id])
  rol  Rol  @relation(fields: [id_rol], references: [id])

  @@id([id_usuario, id_rol])
  @@map("RolUsuario")
}

model Bitacora {
  Id     Int     @id @default(autoincrement())
  UserId Int?
  Tipo   String? @db.VarChar(255)
}

model Modulos {
  id        Int     @id @default(autoincrement()) @map("id")
  nombre    String  @db.VarChar(255)
  descripcion String? @db.VarChar(255)
  permisosModulos PermisosModulos[]

  @@map("Modulos")
}

model Permisos {
  id        Int     @id @default(autoincrement()) @map("id")
  nombre    String  @db.VarChar(255)
  descripcion String? @db.VarChar(255)
  permisosModulos PermisosModulos[]

  @@map("Permisos")
}

model PermisosModulos {
  rolId     Int     @map("rolId")
  moduloId  Int     @map("moduloId")
  permisoId Int     @map("permisoId")

  rol    Rol      @relation(fields: [rolId], references: [id])
  modulo Modulos  @relation(fields: [moduloId], references: [id])
  permiso Permisos @relation(fields: [permisoId], references: [id])

  @@id([rolId, moduloId, permisoId])
  @@map("PermisosModulos")
}

model Estudiante{
  idEstudiante Int @id @default(autoincrement()) @map("IdEstudiante")
  cedula String @db.VarChar(25)
  idPrograma Int @map("IdPrograma")
  nombreCompleto  String?  @db.VarChar(80)
  genero          String?  @db.VarChar(20)
  nacionalidad    String?  @db.VarChar(60)
  fechaNacimiento DateTime? @db.Date
  telefono        String?  @db.VarChar(30)
  correo          String?  @db.VarChar(120)
  direccion       String?  @db.VarChar(255)
  gradoEscolar    String?  @map("GradoEscolar") @db.VarChar(60)
  institucion     String?  @db.VarChar(120)
  lugarTrabajo    String?  @map("LugarTrabajo") @db.VarChar(120)
  ocupacion       String?  @map("Ocupacion") @db.VarChar(80)
  numeroPoliza    String?  @db.VarChar(60)
  discapacidad    String?  @default("E") @db.VarChar(5) 
  detalles        String?  @map("Detalles") @db.VarChar(255)
  status          String?  @map("Status") @default("A") @db.VarChar(5) 
  @@map("Estudiante")
}

model EncargadoLegal{
  idEncargado   Int      @id @default(autoincrement())
  idEstudiante  Int
  nombre        String   @db.VarChar(80) 
  cedula        String?  @db.VarChar(25)
  telefono      String?  @db.VarChar(30)
  correo        String?  @db.VarChar(120)
  lugarTrabajo  String?  @db.VarChar(120)
  ocupacion     String?  @db.VarChar(80)
  @@map("EncargadoLegal")
}

model AutorizadoRetiro{
  idAutorizado  Int      @id @default(autoincrement())
  idEstudiante  Int
  nombre        String   @db.VarChar(120) 
  parentesco    String?  @db.VarChar(60)
  telefono      String?  @db.VarChar(30)
  @@map("AutorizadoRetiro")
}